{%- liquid
  assign request_path = request.path | split: '?' | first | downcase
  assign has_custom_logo = false
  if settings.logo != blank
    assign has_custom_logo = true
  endif

  assign tienda_link = section.settings.tienda_link
  if tienda_link == blank
    assign tienda_link = routes.all_products_collection_url
  endif

  assign sobre_link = section.settings.sobre_link
  if sobre_link == blank
    assign sobre_link = '/pages/sobre-nosotras'
  endif

  assign more_link_1 = section.settings.more_link_1_url
  if more_link_1 == blank
    assign more_link_1 = '/blogs/news'
  endif

  assign more_link_2 = section.settings.more_link_2_url
  if more_link_2 == blank
    assign more_link_2 = '/pages/dentistas'
  endif

  assign more_link_3 = section.settings.more_link_3_url
  if more_link_3 == blank
    assign more_link_3 = '/pages/contacto'
  endif

  assign is_tienda_active = false
  if request.page_type == 'collection' or request_path contains '/collections'
    assign is_tienda_active = true
  endif

  assign is_sobre_active = false
  if request.page_type == 'page' and page.handle != blank
    if page.handle == 'sobre-nosotras' or page.handle == 'about'
      assign is_sobre_active = true
    endif
  endif

  assign is_blog_active = false
  if request.page_type == 'blog' or request.page_type == 'article' or request_path contains '/blogs/'
    assign is_blog_active = true
  endif

  assign is_dentistas_active = false
  if request.page_type == 'page' and page.handle == 'dentistas'
    assign is_dentistas_active = true
  endif

  assign is_contact_active = false
  if request.page_type == 'page' and page.handle != blank
    if page.handle == 'contacto' or page.handle == 'contact'
      assign is_contact_active = true
    endif
  endif

  assign is_more_active = false
  if is_blog_active or is_dentistas_active or is_contact_active
    assign is_more_active = true
  endif
-%}

{%- style -%}
  .section-{{ section.id }}-spacing {
    margin-bottom: {{ section.settings.margin_bottom | times: 0.75 | round: 0 }}px;
  }

  @media screen and (min-width: 750px) {
    .section-{{ section.id }}-spacing {
      margin-bottom: {{ section.settings.margin_bottom }}px;
    }
  }
{%- endstyle -%}

<header class="minima-header section-{{ section.id }}-spacing color-{{ section.settings.color_scheme }} gradient{% if section.settings.sticky_header %} minima-header--sticky{% endif %}">
  {%- if section.settings.show_announcement and section.settings.announcement_text != blank -%}
    <div class="minima-header__announcement">
      <div class="page-width">
        <p class="minima-header__announcement-line">{{ section.settings.announcement_text }}</p>
        {%- if section.settings.announcement_subtext != blank -%}
          <p class="minima-header__announcement-subline">{{ section.settings.announcement_subtext }}</p>
        {%- endif -%}
      </div>
    </div>
  {%- endif -%}

  <div class="page-width minima-header__main">
    <a href="{{ routes.root_url }}" class="minima-header__brand link link--text focus-inset">
      {%- if has_custom_logo -%}
        <span class="minima-header__logo-wrap minima-header__logo-wrap--uploaded">
          {%- assign logo_alt = settings.logo.alt | default: shop.name | escape -%}
          {%- assign logo_width = settings.logo_width | at_least: 96 -%}
          {%- assign logo_height = logo_width | divided_by: settings.logo.aspect_ratio -%}
          {{
            settings.logo
            | image_url: width: 640
            | image_tag:
              class: 'minima-header__logo',
              widths: '96, 140, 180, 240, 320, 420, 640',
              height: logo_height,
              width: logo_width,
              alt: logo_alt,
              sizes: '(min-width: 990px) min(28vw, 240px), 40vw'
          }}
        </span>
      {%- else -%}
        <span class="minima-header__logo-wrap minima-header__logo-wrap--fallback">
          <img
            src="{{ 'minima.png' | asset_url }}"
            class="minima-header__logo"
            alt="{{ section.settings.logo_text | default: shop.name | escape }}"
            width="2200"
            height="834"
            loading="eager"
          >
        </span>
      {%- endif -%}
    </a>

    <div class="minima-header__navigation-wrap">
      <nav class="minima-header__nav" aria-label="Principal">
        <a
          href="{{ tienda_link }}"
          class="minima-header__nav-link{% if is_tienda_active %} is-active{% endif %}"
        >
          {{ section.settings.tienda_label }}
        </a>
        <a
          href="{{ sobre_link }}"
          class="minima-header__nav-link{% if is_sobre_active %} is-active{% endif %}"
        >
          {{ section.settings.sobre_label }}
        </a>
        <details class="minima-header__more-menu">
          <summary class="minima-header__nav-link minima-header__nav-link--summary{% if is_more_active %} is-active{% endif %}">
            {{ section.settings.mas_label }}
            <span class="svg-wrapper">{{ 'icon-caret.svg' | inline_asset_content }}</span>
          </summary>
          <div class="minima-header__more-dropdown">
            <a href="{{ more_link_1 }}" class="minima-header__dropdown-link{% if is_blog_active %} is-active{% endif %}">{{ section.settings.more_link_1_label }}</a>
            <a href="{{ more_link_2 }}" class="minima-header__dropdown-link{% if is_dentistas_active %} is-active{% endif %}">{{ section.settings.more_link_2_label }}</a>
            <a href="{{ more_link_3 }}" class="minima-header__dropdown-link{% if is_contact_active %} is-active{% endif %}">{{ section.settings.more_link_3_label }}</a>
          </div>
        </details>
      </nav>

      <div class="minima-header__utilities">
        <form action="{{ routes.search_url }}" method="get" role="search" class="minima-header__search-form">
          <input type="hidden" name="options[prefix]" value="last">
          <label class="visually-hidden" for="MinimaHeaderSearch-{{ section.id }}">{{ 'general.search.search' | t }}</label>
          <input
            id="MinimaHeaderSearch-{{ section.id }}"
            class="minima-header__search-input"
            type="search"
            name="q"
            value="{{ search.terms | escape }}"
            placeholder="{{ section.settings.search_placeholder }}"
            autocorrect="off"
            autocapitalize="off"
            autocomplete="off"
          >
          <button type="submit" class="minima-header__search-button" aria-label="{{ 'general.search.search' | t }}">
            <span class="svg-wrapper">{{ 'icon-search.svg' | inline_asset_content }}</span>
          </button>
        </form>

        <a href="{{ routes.cart_url }}" class="minima-header__cart-link link link--text focus-inset" id="minima-header-cart">
          <span class="minima-header__cart-label">{{ section.settings.cart_label }}</span>
          {%- if cart == empty -%}
            <span class="svg-wrapper">{{ 'icon-cart-empty.svg' | inline_asset_content }}</span>
          {%- else -%}
            <span class="svg-wrapper">{{ 'icon-cart.svg' | inline_asset_content }}</span>
          {%- endif -%}
          {%- if cart.item_count > 0 -%}
            <span class="minima-header__cart-badge">{{ cart.item_count }}</span>
          {%- endif -%}
        </a>
      </div>
    </div>
  </div>
</header>

{% schema %}
{
  "name": "Minima header",
  "class": "section-header",
  "settings": [
    {
      "type": "checkbox",
      "id": "sticky_header",
      "label": "Sticky header",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_announcement",
      "label": "Show announcement",
      "default": true
    },
    {
      "type": "text",
      "id": "announcement_text",
      "label": "Announcement text",
      "default": "Envios GRATIS: pedidos superiores a 35 euros"
    },
    {
      "type": "text",
      "id": "announcement_subtext",
      "label": "Announcement subtext",
      "default": "Registrate en la newsletter para conseguir 5% de descuento!"
    },
    {
      "type": "inline_richtext",
      "id": "logo_text",
      "label": "Logo text",
      "default": "Minima Organics"
    },
    {
      "type": "text",
      "id": "tienda_label",
      "label": "Store label",
      "default": "Tienda"
    },
    {
      "type": "url",
      "id": "tienda_link",
      "label": "Store link"
    },
    {
      "type": "text",
      "id": "sobre_label",
      "label": "About label",
      "default": "Sobre nosotras"
    },
    {
      "type": "url",
      "id": "sobre_link",
      "label": "About link"
    },
    {
      "type": "text",
      "id": "mas_label",
      "label": "More label",
      "default": "Mas"
    },
    {
      "type": "text",
      "id": "more_link_1_label",
      "label": "More link 1 label",
      "default": "Blog"
    },
    {
      "type": "url",
      "id": "more_link_1_url",
      "label": "More link 1 URL"
    },
    {
      "type": "text",
      "id": "more_link_2_label",
      "label": "More link 2 label",
      "default": "Dentistas"
    },
    {
      "type": "url",
      "id": "more_link_2_url",
      "label": "More link 2 URL"
    },
    {
      "type": "text",
      "id": "more_link_3_label",
      "label": "More link 3 label",
      "default": "Contacto"
    },
    {
      "type": "url",
      "id": "more_link_3_url",
      "label": "More link 3 URL"
    },
    {
      "type": "text",
      "id": "search_placeholder",
      "label": "Search placeholder",
      "default": "Estoy buscando..."
    },
    {
      "type": "text",
      "id": "cart_label",
      "label": "Cart label",
      "default": "Cesta"
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "Color scheme",
      "default": "scheme-2"
    },
    {
      "type": "header",
      "content": "Spacing"
    },
    {
      "type": "range",
      "id": "margin_bottom",
      "min": 0,
      "max": 48,
      "step": 4,
      "unit": "px",
      "label": "Bottom margin",
      "default": 0
    }
  ]
}
{% endschema %}
